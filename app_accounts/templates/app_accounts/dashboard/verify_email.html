{% extends 'ap2_student/dashboard/dc_base.html' %}
{% load static %}
{% block head_title %}Email Verification{% endblock %}
{% block head_style_plugins %}
    <!-- Plugins CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/vendor/font-awesome/css/all.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/vendor/aos/aos.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/vendor/choices/css/choices.min.css' %}">
{% endblock %}
{% block my_style %}
        <link rel="stylesheet" type="text/css" href="{% static 'app_accounts/css/verify_email.css' %}">
{% endblock %}
{% block head_script %}
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endblock %}

{% block dc_banner %}{% endblock %}
{% block dc_sidebar %}{% endblock %}

{% block dashboard_main_content %}
    <div class="verification-container bg-light rounded-3 p-3 p-md-5 shadow-sm"
         style="max-width: 800px; margin: 1rem auto;">
        <div class="text-center mb-4">
            {#                            <img src="{% static 'assets/images/favicon.png' %}" alt="Logo" style="height: 50px;">#}
            <h2 class="mt-3">Verify Your Email Address</h2>
            <p class="lead text-muted">You're almost ready to start!</p>
        </div>
        <input type="hidden" id="next_resend" value="{{ next_resend }}">
        <input type="hidden" id="csrf_token" value="{{ csrf_token }}">
        <div class="card border-0 shadow-none">
            <div class="card-body text-center">
                <div class="verification-icon"><i class="bi bi-envelope-check display-6"></i></div>
                <div class="verification-alert  alert-info">
                    We've sent an activation link to <strong>{{ user.email }}</strong>.
                    Please check your inbox and click the link to activate your account.
                </div>

                <div class="alert alert-success my-3  d-none" id="statusMessage">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <span>Verification email sent! Check your inbox.</span>
                </div>


                <div class="text-center">
                    {% if attempts_remaining > 0 %}

                        {% if requires_captcha %}
                            <small class="text-muted d-block my-1">Please verify you're not a robot</small>
                            <div id="captcha-container" class="my-2 d-block d-flex justify-content-center">
                                <div class="g-recaptcha" data-sitekey="{{ recaptcha_site_key }}"></div>
                            </div>
                        {% endif %}

                        <button id="resend-btn" class="btn btn-primary"
                                data-url="{{ resend_url }}"
                                {% if next_resend %}disabled{% endif %}>
                            <i class="bi bi-send-fill me-2"></i>
                            Resend Verification Email
                            {% if next_resend %}
                                <span id="countdown" class="countdown">({{ next_resend }} s)</span>
                            {% endif %}
                        </button>

                        <p class="attempts-counter">
                            Attempts remaining: {{ attempts_remaining }} of {{ max_attempts }}
                        </p>
                    {% else %}
                        <div class="verification-alert alert-warning">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            You've reached the maximum resend attempts. Please try again later.
                        </div>
                    {% endif %}

                    <div id="statusMessage" class="verification-alert alert-success mt-3 d-none">
                        <i class="bi bi-check-circle-fill me-2"></i>
                        Verification email sent successfully! Please check your inbox.
                    </div>
                </div>

                <hr class="my-4">
                <p class="text-muted small mb-0">
                    Didn't receive the email? Check your spam folder
                    {#                    or <a href="{% url 'client:dc_setting' %}">update your email address</a>.#}
                </p>

                <div class="footer-links">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#changeEmailModal">
                        <i class="bi bi-pencil-square me-1"></i>Update Email
                    </a>
                    <a href="{% url 'app_pages:help_center' %}" target="_blank">
                        <i class="bi bi-question-circle me-1"></i>Need Help?
                    </a>
                    <a href="#" onclick="window.location.reload();">
                        <i class="bi bi-arrow-clockwise me-1"></i>Refresh Page
                    </a>
                </div>

            </div>
        </div>
    </div>

    <!-- Change Email Modal (hidden by default) -->
    <div class="modal fade" id="changeEmailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Email Address</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>To update your email address, please contact our support team or visit your account
                        settings.</p>
                    <a href="{% url 'client:dc_setting' %}" class="btn btn-primary w-100">
                        Go to Account Settings
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts_vendors %}
    <script src="{% static 'assets/vendor/choices/js/choices.min.js' %}"></script>
    <script src="{% static 'assets/vendor/aos/aos.js' %}"></script>
{% endblock %}

{% block my_scripts %}
    <script type="module" src="{% static 'app_accounts/js/verify_email.min.js' %}"></script>
{% endblock %}